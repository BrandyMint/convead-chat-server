convead-chat-server
===================

Faye chat server for Convead.com

Канал чата `/chat/:conversation_id`
----------------------------------

Можно следить за всеми чатами одновременно `/chat/*` это будет называться <tt>общий канал чата</tt>.

### Сообщения/События

* `connected` (`faye-only`) - пользователь зашел на страницу, появился в сети.
* `open` - событие возникает когда у пользователя открылось окно чата.
* `closed` - у пользователя закрылось окно чата.
* `message` - пришло сообщение.
* `call` - пользователь изъявил желание по-чатиться (вызывает менеджера). Это собыние возникает тогда же когда и `open`

### Обработка событий

#### На сервере

* `connected` - По приему этого события пользователю отсылается непрочитанная история чата (пихается в канал событием `message`). Сейчас это реализовано через ajax-запрос в API `get_unread`

#### На клиенте

* `message` - Сообщение помещается в историю. Если оно там уже есть, то замещается новым (скорее всгео у него установился флаг `ready`)

#### На клиенте дежурного менеджера

Дежурный менеджер следит за общим каналом.

* `call` - стартует окно чата с указанным пользователем.
